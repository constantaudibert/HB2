<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Joyeux Anniversaire ðŸŽ‚</title>
  <style>
    body {
      background: #dad2d0;
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      color: #fff;
    }
    h1 {
      margin-top: 30px;
      font-size: 2.4rem;
      letter-spacing: 2px;
      text-shadow: 0px 2px 4px #000a;
    }
    .gateau-container {
      width: 95vw;
      max-width: 420px;
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #message {
      margin: 1.4em 0 0.7em 0;
      font-size: 1.1em;
      font-weight: bold;
      text-align: center;
    }
    .tuto {
      font-size: 1em;
      background: #43231fc7;
      padding: 3px 12px;
      border-radius: 14px;
      margin-bottom: 25px;
      margin-top: 4px;
      display: inline-block;
      box-shadow: 0 0 5px #0005;
    }
    @media (max-width: 600px) {
      .gateau-container { max-width: 98vw; }
      h1 { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <h1>Joyeux anniversaire !</h1>
  <div class="gateau-container">
    <svg id="gateau" width="100%" height="340" viewBox="0 0 400 340">
      <!-- Ombre -->
      <ellipse cx="200" cy="305" rx="110" ry="23" fill="#5b3622" opacity="0.55"/>
      <!-- Corps du gÃ¢teau (chocolat) -->
      <ellipse cx="200" cy="240" rx="110" ry="22" fill="#2d1810"/>
      <rect x="90" y="160" width="220" height="80" fill="#2d1810"/>
      <!-- dessus -->
      <ellipse cx="200" cy="160" rx="110" ry="60" fill="#43231fc7"/>
      <!-- Cerises ForÃªt Noire -->
      <circle cx="120" cy="170" r="11" fill="#ce0b2d"/>
      <circle cx="170" cy="153" r="11" fill="#ce0b2d"/>
      <circle cx="230" cy="153" r="11" fill="#ce0b2d"/>
      <circle cx="280" cy="170" r="11" fill="#ce0b2d"/>
      <circle cx="200" cy="182" r="11" fill="#ce0b2d"/>
      <!-- Bougies gÃ©nÃ©rÃ©es dynamiquement -->
      <g id="bougies"></g>
    </svg>
    <div id="message">Fais un voeu avant de souffler tes bougiesâ€¯!</div>
    <div class="tuto">
      Secoue ton tÃ©lÃ©phone pour souffler les bougiesâ€¯!<br/>
      Sur ordinateur, appuie sur <b>Barre dâ€™espace</b>, R pour rallumer.
    </div>
  </div>
  <script>
    const NB_BOUGIES = 16;
    const bx_center = 200, by_center = 160, bx_rx = 110, bx_ry = 60; // Ellipse du dessus

    function createBougies(node, allumee = true) {
      node.innerHTML = '';
      for (let i = 0; i < NB_BOUGIES; i++) {
        const angle = (i / NB_BOUGIES) * 2 * Math.PI;
        const bx = bx_center + bx_rx * Math.cos(angle);
        const by = by_center + bx_ry * Math.sin(angle);
        node.innerHTML += `
          <g>
            <rect x="${bx-5}" y="${by-30}" width="10" height="22" fill="#fff" stroke="#a4a4b7" rx="3"/>
            <ellipse class="flamme" id="flamme${i}" cx="${bx}" cy="${by-36}" rx="5" ry="8"
              fill="gold" style="opacity:${allumee?1:0};filter:drop-shadow(0px 0px 7px #ffa);">
            </ellipse>
          </g>`;
      }
    }

    const bougiesNode = document.getElementById("bougies");
    createBougies(bougiesNode, true);

    // Animation des flammes
    function animerFlammes() {
      const flammes = document.querySelectorAll(".flamme");
      flammes.forEach((f,i)=>{
        if (f.style.opacity === "0") return;
        let t = Date.now()/400 + i*1.6;
        let dx = Math.sin(t)*1.2, dy = Math.cos(t*1.7)*1.2;
        f.setAttribute("cx", Number(f.getAttribute("cx_orig")) + dx || f.getAttribute("cx"));
        f.setAttribute("cy", Number(f.getAttribute("cy_orig")) + dy || f.getAttribute("cy"));
      });
      requestAnimationFrame(animerFlammes);
    }
    document.querySelectorAll(".flamme").forEach(fl=> {
      fl.setAttribute("cx_orig", fl.getAttribute("cx"));
      fl.setAttribute("cy_orig", fl.getAttribute("cy"));
    });
    animerFlammes();

    // Extinction
    function eteindreBougies() {
      document.getElementById('message').textContent = "Bravo, toutes les bougies sont Ã©teintesâ€¯! ðŸŽ‰";
      for (let i = 0; i < NB_BOUGIES; i++) {
        const flamme = document.getElementById(`flamme${i}`);
        if (flamme) {
          flamme.style.transition = "opacity 0.6s";
          flamme.style.opacity = "0";
        }
      }
    }
    function rallumerBougies() {
      document.getElementById('message').textContent = "Secoue ton tÃ©lÃ©phone pour souffler les bougiesâ€¯!";
      for (let i = 0; i < NB_BOUGIES; i++) {
        const flamme = document.getElementById(`flamme${i}`);
        if (flamme) {
          flamme.style.transition = "opacity 0.6s";
          flamme.style.opacity = "1";
        }
      }
    }
    let lastShake = 0;
    let alreadyOff = false;
    if (window.DeviceMotionEvent) {
      window.addEventListener('devicemotion', function(e) {
        const acc = e.accelerationIncludingGravity;
        const force = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z);
        const now = Date.now();
        if (force > 18 && now-lastShake > 2000 && !alreadyOff) {
          eteindreBougies();
          alreadyOff = true;
          lastShake = now;
        }
      });
    }
    document.body.addEventListener("keydown", function(e) {
      if ((e.code=="Space" || e.keyCode==32) && !alreadyOff) {
        eteindreBougies();
        alreadyOff = true;
      }
      if ((e.code=="KeyR" || e.keyCode==82)) {
        rallumerBougies();
        alreadyOff = false;
      }
    });
  </script>
</body>
</html>
